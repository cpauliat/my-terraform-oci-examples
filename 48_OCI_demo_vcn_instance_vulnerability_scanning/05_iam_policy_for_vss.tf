# # ---- Create IAM policy to allow VSS to scan compute instances in tenancy
# resource oci_identity_policy tf-demo48-policy {
#   compartment_id = var.tenancy_ocid
#   name           = "tf-demo48-policy-vss"
#   description    = "Policy required for Vulnerability Scanning in tenancy"
#   statements     = [ "allow service vulnerability-scanning-service to manage instances in tenancy",
#                      "allow service vulnerability-scanning-service to read compartments in tenancy",
#                      "allow service vulnerability-scanning-service to read vnics in tenancy",
#                      "allow service vulnerability-scanning-service to read vnic-attachments in tenancy" ]
# }

# ---- Create IAM policy to allow VSS to scan compute instances in compartment
data oci_identity_compartment tf-demo48-cpt {
  id = var.compartment_ocid
}

resource oci_identity_policy tf-demo48-policy {
  compartment_id = var.compartment_ocid
  name           = "tf-demo48-policy-vss"
  description    = "Policy required for Vulnerability Scanning in compartment ${data.oci_identity_compartment.tf-demo48-cpt.name}"
  statements     = [ "allow service vulnerability-scanning-service to manage instances in compartment ${data.oci_identity_compartment.tf-demo48-cpt.name}",
                     "allow service vulnerability-scanning-service to read compartments in compartment ${data.oci_identity_compartment.tf-demo48-cpt.name}",
                     "allow service vulnerability-scanning-service to read vnics in compartment ${data.oci_identity_compartment.tf-demo48-cpt.name}",
                     "allow service vulnerability-scanning-service to read vnic-attachments in compartment ${data.oci_identity_compartment.tf-demo48-cpt.name}" ]
}